#!@BASH@

# setup with venv
if [ -f "@DUNE_PYTHON_VIRTUALENV_PATH@/bin/activate" ]; then
  source @DUNE_PYTHON_VIRTUALENV_PATH@/bin/activate

  # test if build directory matches installed dune python packages
  python -m dune checkbuilddirs --args @PROJECT_NAME@ @CMAKE_BINARY_DIR@

# setup without venv
elif [ -f "@CMAKE_BINARY_DIR@/set-dune-pythonpath" ]; then
  source @CMAKE_BINARY_DIR@/set-dune-pythonpath

else
  echo "Dune internal virtual environment not found:"
  echo "No activate script in @DUNE_PYTHON_VIRTUALENV_PATH@/bin"
  exit 77
fi

if [ $? -eq 0 ] ; then
  "$@"
else
  echo "Dune python package could not be found."
  exit 77
fi
